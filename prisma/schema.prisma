generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ----------------------
// ODTW (model yang dibutuhkan oleh kode lama)
// ----------------------
model Odtw {
  id   String  @id @default(uuid())
  name String?
  // Jika kamu butuh field tambahan untuk Odtw, tambahkan di sini

  // relation -> user(s)
  users User[] @relation("OdtwUsers")
}

// ----------------------
// USER
// ----------------------
model User {
  id         String  @id @default(uuid())
  username   String  @unique
  email      String  @unique
  phone      String?
  password   String
  role       String
  first_name String?
  last_name  String?
  status     String  @default("active")

  // fields used by your auth code (timestamps as epoch seconds)
  created_at             Int?    @default(0)
  updated_at             Int?    @default(0)
  deleted_at             Int? // null = not deleted
  password_reset_token   String?
  password_reset_expires Int?

  // optional foreign keys used in your code
  odtw_id String?
  user_id String? // left in because some selects requested user_id

  // relations
  odtw                Odtw?          @relation("OdtwUsers", fields: [odtw_id], references: [id])
  loans               Loan[]
  createdItems        Item[]         @relation("ItemCreatedBy")
  updatedItems        Item[]         @relation("ItemUpdatedBy")
  itemMovementCreated ItemMovement[] @relation("MovementCreatedBy")
  itemMovementUpdated ItemMovement[] @relation("MovementUpdatedBy")

  createdWarehouses Warehouse[] @relation("WarehouseCreatedBy")
  updatedWarehouses Warehouse[] @relation("WarehouseUpdatedBy")
}

// ----------------------
// CATEGORY
// ----------------------
model Category {
  id   String @id @default(uuid())
  name String

  items Item[]
}

// ----------------------
// UNIT
// ----------------------
model Unit {
  id   String @id @default(uuid())
  name String

  items Item[]
}

// ----------------------
// WAREHOUSE
// ----------------------
model Warehouse {
  id      String  @id @default(uuid())
  name    String
  address String?
  status  String?

  created_by String?
  updated_by String?

  createdBy User? @relation("WarehouseCreatedBy", fields: [created_by], references: [id])
  updatedBy User? @relation("WarehouseUpdatedBy", fields: [updated_by], references: [id])

  items Item[]
  sku   SKU[]
}

// ----------------------
// ITEM
// ----------------------
model Item {
  id           String  @id @default(uuid())
  unit_id      String
  category_id  String
  warehouse_id String?
  name         String
  supplier     String?
  price        Int?
  stock        Int
  description  String?
  code         String?
  image        String?

  created_by String?
  updated_by String?

  unit     Unit     @relation(fields: [unit_id], references: [id])
  category Category @relation(fields: [category_id], references: [id])

  warehouse Warehouse? @relation(fields: [warehouse_id], references: [id])

  createdBy User? @relation("ItemCreatedBy", fields: [created_by], references: [id])
  updatedBy User? @relation("ItemUpdatedBy", fields: [updated_by], references: [id])

  sku             SKU[]
  movementDetails ItemMovementDetail[]
}

// ----------------------
// SKU
// ----------------------
model SKU {
  id        String @id @default(uuid())
  item_id   String
  code      String
  name      String
  warehouse_id String?

  item       Item @relation(fields: [item_id], references: [id])
  warehouse  Warehouse? @relation(fields: [warehouse_id], references: [id])

  movementDetail ItemMovementDetail[]
  loanDetails    LoanDetail[]
}

// ----------------------
// ITEM MOVEMENT
// ----------------------
model ItemMovement {
  id           String    @id @default(uuid())
  name         String
  memo_number  String?
  email        String?
  necessity    String?
  request_date DateTime?
  created_by   String?
  updated_by   String?

  createdBy User? @relation("MovementCreatedBy", fields: [created_by], references: [id])
  updatedBy User? @relation("MovementUpdatedBy", fields: [updated_by], references: [id])

  details ItemMovementDetail[]
}

// ----------------------
// ITEM MOVEMENT DETAIL
// ----------------------
model ItemMovementDetail {
  id               String  @id @default(uuid())
  item_movement_id String
  sku_id           String
  item_id          String?

  movement ItemMovement @relation(fields: [item_movement_id], references: [id])
  sku      SKU          @relation(fields: [sku_id], references: [id])

  item Item? @relation(fields: [item_id], references: [id])
}

// ----------------------
// LOAN
// ----------------------
  model loans {
  id          Int           @id @default(autoincrement())
  name        String
  phone_number String?
  email       String?
  necessity   String?
  note        String?
  loan_date   DateTime?
  created_by  String?
  updated_by  String?
  loan_details loan_details[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

// ----------------------
// LOAN DETAIL
// ----------------------
model loan_details {
  id          Int      @id @default(autoincrement())
  loan_id     Int
  sku_id      String   // FIX: SKU.id is String, not Int
  qty         Int
  return_date DateTime?
  status      String?  @default("borrowed")

  loan loans @relation(fields: [loan_id], references: [id])
  sku  SKU   @relation(fields: [sku_id], references: [id])   // FIX: use SKU model
}
