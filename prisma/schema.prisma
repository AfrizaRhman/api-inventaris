generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["clientExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * ================================
 * UNIT
 * ================================
 */
model Unit {
  id         String    @id @default(uuid())
  name       String 
  deleted_at DateTime?

  item Item[]
}

/**
 * ================================
 * CATEGORIES
 * ================================
 */
model Categories {
  id     String  @id @default(uuid())
  name   String
  code   String?
  status String  @default("active")

  created_by String?
  updated_by String?
  deleted_by String?

  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime?

  item Item[]
}

/**
 * ================================
 * WAREHOUSE
 * ================================
 */
model Warehouse {
  id         String  @id @default(uuid())
  name       String
  address    String?
  status     String?
  created_by String?
  updated_by String?

  deleted_at DateTime?

  sku Sku[]
}

/**
 * ================================
 * ITEM
 * ================================
 */
model Item {
  id          String  @id @default(uuid())
  unit_id     String
  category_id String
  name        String
  image       String?
  supplier    String?
  price       Int?
  stock       Int
  description String?
  code        String?

  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime?

  unit     Unit       @relation(fields: [unit_id], references: [id])
  category Categories @relation(fields: [category_id], references: [id])
  sku      Sku[]
}

/**
 * ================================
 * SKU
 * ================================
 */
model Sku {
  id           String  @id @default(uuid())
  item_id      String
  code         String
  color        String?
  status       String?
  warehouse_id String?

  created_at DateTime?
  updated_at DateTime?
  deleted_at DateTime?

  item      Item       @relation(fields: [item_id], references: [id])
  warehouse Warehouse? @relation(fields: [warehouse_id], references: [id])

  loanDetail         LoanDetail[]
  itemMovementDetail ItemMovementDetail[]
}

/**
 * ================================
 * USER
 * ================================
 */
model User {
  id         String  @id @default(uuid())
  username   String  @unique
  email      String? @unique
  phone      String?
  password   String
  role       String
  first_name String?
  last_name  String?
  status     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  odtw_id String?
  odtw    Odtw?   @relation("OdtwUsers", fields: [odtw_id], references: [id])

  deleted_at DateTime?
}

/**
 * ================================
 * ODTW
 * ================================
 */
model Odtw {
  id   String  @id @default(uuid())
  name String?

  users User[] @relation("OdtwUsers")

  deleted_at DateTime?
}

/**
 * ================================
 * LOAN
 * ================================
 */
model Loan {
  id   String @id @default(uuid())
  name String

  loan_details LoanDetail[]
}

/**
 * ================================
 * LOAN DETAIL
 * ================================
 */
model LoanDetail {
  id          String    @id @default(uuid())
  loan_id     String
  sku_id      String
  qty         Int?
  return_date DateTime?
  status      String?

  loan Loan @relation(fields: [loan_id], references: [id])
  sku  Sku  @relation(fields: [sku_id], references: [id])
}

/**
 * ================================
 * ITEM MOVEMENT
 * ================================
 */
model ItemMovement {
  id           String    @id @default(uuid())
  name         String
  phone_number String?
  email        String?
  necessity    String?
  request_date DateTime?
  created_by   String?
  updated_by   String?
  deleted_at   DateTime?

  details ItemMovementDetail[]
}



/**
 * ================================
 * ITEM MOVEMENT DETAIL
 * ================================
 */
model ItemMovementDetail {
  id               String   @id @default(uuid())
  item_movement_id String
  sku_id           String
  sku_code         String?
  deleted_at       DateTime?

  item_movement ItemMovement @relation(fields: [item_movement_id], references: [id])
  sku           Sku          @relation(fields: [sku_id], references: [id])
}


