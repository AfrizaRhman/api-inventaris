generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Unit {
  id    String  @id @default(uuid())
  name  String

  item Item[]
}

model Categories {
  id    String  @id @default(uuid())
  name  String
  code  String?

  item Item[]
}

model Warehouse {
  id         String   @id @default(uuid())
  name       String
  address    String?
  status     String?
  created_by String?
  updated_by String?

  deleted_at Int?

  sku Sku[]
}

model Item {
   id          String   @id @default(uuid())
   unit_id     String
   category_id String
   name        String
   image       String?
   suplier     String?
   price       Int?
   stock       Int
   description String?
   code        String?

   unit     Unit     @relation(fields: [unit_id], references: [id])
   category Categories @relation(fields: [category_id], references: [id])
   sku      Sku[]
}

model Sku {
  id          String   @id @default(uuid())
  item_id     String
  code        String
  color       String?
  status      String?
  warehouse_id String?

  // relations
  item      Item     @relation(fields: [item_id], references: [id])
  warehouse Warehouse? @relation(fields: [warehouse_id], references: [id])
  loanDetail LoanDetail[]
  itemMovementDetail ItemMovementDetail[]
}

model User {
  id          String   @id @default(uuid())
  username    String   @unique
  email       String?  @unique
  phone       String?
  password    String
  role        String
  first_name  String?
  last_name   String?
  status      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relasi ke Odtw
  odtw_id     String?
  odtw        Odtw?    @relation("OdtwUsers", fields: [odtw_id], references: [id])

  deleted_at  Int?
}

model Odtw {
  id         String   @id @default(uuid())
  name       String?

  // Relasi: satu Odtw bisa punya banyak User
  users      User[]   @relation("OdtwUsers")

  // Soft delete, dipakai oleh prisma-extension-soft-delete
  deleted_at Int?
}


model Loan {
  id           String    @id @default(uuid())
  name         String
  phone_number String?
  email        String?
  necessity    String?
  note         String?
  loan_date    DateTime?

  loan_detail LoanDetail[]
}

model LoanDetail {
  id        String   @id @default(uuid())
  loan_id   String
  sku_id    String
  qty       Int?
  return_date DateTime?
  status    String?

  loan Loan @relation(fields: [loan_id], references: [id])
  sku  Sku   @relation(fields: [sku_id], references: [id])
}

model Item_Movement {
  id           String   @id @default(uuid())
  name         String
  phone_number String?
  email        String?
  necessity    String?
  request_date DateTime?
  created_by   String?
  updated_by   String?

  detail ItemMovementDetail[]
}

model ItemMovementDetail {
  id              String @id @default(uuid())
  item_movement_id String
  sku_id          String
  sku_code        String?

  movement Item_Movement @relation(fields: [item_movement_id], references: [id])
  sku      Sku           @relation(fields: [sku_id], references: [id])

  @@map("item_movement_detail")
}
