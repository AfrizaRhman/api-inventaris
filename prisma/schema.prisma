generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Unit {
  id         String   @id @default(uuid())
  name       String
  deleted_at DateTime?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  items Item[] // <- ini WAJIB
}

model Categories {
  id     String  @id @default(uuid())
  name   String
  code   String?
  status String  @default("active")

  created_by String?
  updated_by String?
  deleted_by String?

  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime?

  item Item[]
}

model Warehouse {
  id         String  @id @default(uuid())
  name       String
  address    String?
  status     String?
  created_by String?
  updated_by String?

  deleted_at DateTime?

  sku Sku[]
}

model Item {
  id          String   @id @default(uuid())
  unit_id     String
  category_id String
  name        String
  image       String?
  supplier    String?
  price       Int?
  stock       Int
  description String?
  code        String?

  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime? 

  unit     Unit       @relation(fields: [unit_id], references: [id])
  category Categories @relation(fields: [category_id], references: [id])

  skus Sku[] // âœ… FIX ERROR
}


model Sku {
  id           String  @id @default(uuid())
  item_id      String
  code         String
  color        String?
  status       String?
  warehouse_id String?

   created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  deleted_at DateTime?

  // relations
  item               Item                 @relation(fields: [item_id], references: [id])
  warehouse          Warehouse?           @relation(fields: [warehouse_id], references: [id])
  loan_details        LoanDetail[]
  itemMovementDetail ItemMovementDetail[]
}

model User {
  id         String   @id @default(uuid())
  username   String   @unique
  email      String?  @unique
  phone      String?
  password   String
  role       String
  first_name String?
  last_name  String?
  status     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  deleted_at DateTime?

  // Relasi ke Odtw
  odtw_id String?
  odtw    Odtw?   @relation("OdtwUsers", fields: [odtw_id], references: [id])

}

model Odtw {
  id   String  @id @default(uuid())
  name String?

  // Relasi: satu Odtw bisa punya banyak User
  users User[] @relation("OdtwUsers")

  // Soft delete, dipakai oleh prisma-extension-soft-delete
  deleted_at DateTime?
}

model Loans {
  id           String       @id @default(uuid())
  name         String
  phone_number String
  email        String?
  necessity    String?
  note         String?
  loan_date    DateTime     @default(now())
  deleted_at   Int?
  created_by   String?
  updated_by   String?

  loan_details LoanDetail[]

  @@map("loans")
}

model LoanDetail {
  id          String   @id @default(uuid())
  loan_id     String
  sku_id      String
  qty         Int
  return_date DateTime?
  status      String
  deleted_at  DateTime?

  loan Loans @relation(fields: [loan_id], references: [id], onDelete: Cascade)
  sku  Sku   @relation(fields: [sku_id], references: [id])

  @@map("loan_details")
}

model ItemMovement {
  id           String    @id @default(uuid())
  name         String
  phone_number String?
  email        String?
  necessity    String?
  request_date DateTime?
  created_by   String?
  updated_by   String?
  deleted_at   DateTime?

  details ItemMovementDetail[] @relation("MovementDetails")

  @@map("item_movement")
}


model ItemMovementDetail {
  id               String  @id @default(uuid())
  item_movement_id String
  sku_id           String
  sku_code         String?
  deleted_at       DateTime?

  movement ItemMovement @relation("MovementDetails", fields: [item_movement_id], references: [id])
  sku      Sku          @relation(fields: [sku_id], references: [id])

  @@map("item_movement_detail")
}
